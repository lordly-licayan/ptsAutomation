*** Settings ***
Library           SeleniumLibrary

*** Variables ***
${efocus_url}     url
${browser}        ie
${_username}      GDC7
${_password}      1

*** Keywords ***
Open Login Page
    Set Exclude Window
    xClick Element    BTNVIEW_HC1
    Focus Current Window
    Sleep    1
    Do Login    ${_username}    ${_password}

Open Main Page
    Sleep    2
    Open Browser    ${efocus_url}    ${browser}
    Page Should Contain    e-FOCUS
    Maximize Browser Window

Close Page
    Sleep    1
    Close Browser

Do Login
    [Arguments]    ${username}    ${password}
    xInput Text    EMP_CCD    ${username}
    xInput Text    PWD    ${password}
    xClick Element    BTNENTER

Select Previous Window
    @{windows}=    Get Window Handles
    ${win_length}=    Get Length    ${windows}
    : FOR    ${count}    IN RANGE    ${win_length}
    \    ${index} =    Set Variable    ${win_length-1-${count}}
    \    ${win_stat}=    Run Keyword and Return Status    Select Window    @{windows}[${index}]
    \    Exit For Loop If    ${win_stat}==True

Set Exclude Window
    @{excludes}=    Get Window Handles
    Set Global Variable    @{excludes}

Focus Current Window
    Log    Excluding: ${excludes}
    ${stat}=    Run Keyword And Return Status    Select Window    ${excludes}

xInput Text
    [Arguments]    ${element}    ${value}
    ${stat}=    Run Keyword And Return Status    Input Text    ${element}    ${value}
    Return From Keyword If    ${stat}==True    ${stat}
    ${stat_frame}=    Input on Frame    Input Text    ${element}    ${value}
    Check Element    ${element}    ${stat}

xClick Element
    [Arguments]    ${element}
    Log To Console    Clicking element ${element}
    ${stat_element}=    Run Keyword And Return Status    Click Element    ${element}
    Return From Keyword If    ${stat_element}==True    ${stat_element}
    ${stat_link}=    Run Keyword And Return Status    Click Link    ${element}
    Return From Keyword If    ${stat_link}==True    ${stat_link}
    ${stat_frame_element}=    Click on Frame    Click Element    ${element}
    Return From Keyword If    ${stat_frame_element}==True    ${stat_link}
    ${stat_frame_link}=    Click on Frame    Click Link    ${element}
    Check Element    ${element}    ${stat_frame_link}

xGet Element
    [Arguments]    ${element}
    ${e}    Set Variable    False
    ${elem_exist}=    Run Keyword And Return Status    Get WebElement    ${element}
    Run Keyword And Return If    ${elem_exist}==True    Get WebElement    ${element}
    ${e}=    Run Keyword If    ${elem_exist}==False    xGet Frame Element    ${element}
    Check Element    ${element}    ${e}
    [Return]    ${e}

Click on Frame
    [Arguments]    ${keyword}    ${element}
    ${frames_exist}=    Run Keyword And Return Status    Get WebElements    //frame
    Return From Keyword If    ${frames_exist}==False    ${EMPTY}
    ${frames}=    Get WebElements    //frame
    ${frames_count} =    Get Length    ${frames}
    Return From Keyword If    ${frames_count}==0    ${EMPTY}
    : FOR    ${frame}    IN    @{frames}
    \    ${frame_name}=    Get Element Attribute    ${frame}    name
    \    Select Frame    ${frame_name}
    \    ${stat}=    Run Keyword And Return Status    Run Keyword    ${keyword}    ${element}
    \    Unselect Frame
    \    Exit For Loop If    ${stat}==True
    [Return]    ${stat}

Input on Frame
    [Arguments]    ${keyword}    ${element}    ${value}
    ${frames_exist}=    Run Keyword And Return Status    Get WebElements    //frame
    Return From Keyword If    ${frames_exist}==False    ${EMPTY}
    ${frames}=    Get WebElements    //frame
    ${frames_count} =    Get Length    ${frames}
    Return From Keyword If    ${frames_count}==0    ${EMPTY}
    : FOR    ${frame}    IN    @{frames}
    \    ${frame_name}=    Get Element Attribute    ${frame}    name
    \    Select Frame    ${frame_name}
    \    ${stat}=    Run Keyword And Return Status    Run Keyword    ${keyword}    ${element}    ${value}
    \    Unselect Frame
    \    Exit For Loop If    ${stat}==True
    [Return]    ${stat}

Expect Value
    [Arguments]    ${element}    ${value}
    ${expected_element}=    xGet Element    ${element}
    ${expected_value}=    Get Element Attribute    ${expected_element}    value
    Should Be Equal    ${expected_value}    ${value}

Check Element
    [Arguments]    ${element}    ${flag}
    Should Be True    ${flag}    Element '${element}' not found

xGet Frame Element
    [Arguments]    ${element}
    ${e}    Set Variable    False
    ${frames_exist}=    Run Keyword And Return Status    Get WebElements    //frame
    Return From Keyword If    ${frames_exist}==False    ${e}
    ${frames}=    Get WebElements    //frame
    ${frames_count} =    Get Length    ${frames}
    Return From Keyword If    ${frames_count}==0    ${e}
    : FOR    ${frame}    IN    @{frames}
    \    Select Frame    ${frame}
    \    ${elem_exist}=    Run Keyword And Return Status    Get WebElement    ${element}
    \    Run Keyword If    ${elem_exist}==False    Unselect Frame
    \    Continue For Loop If    ${elem_exist}==False
    \    ${e}=    Get WebElement    ${element}
    \    Unselect Frame
    \    Exit For Loop
    [Return]    ${e}
